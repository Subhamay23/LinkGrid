<section class="full-link-section">
  <div class="link-container">
    <h1 class="link-title"><%- video.title %></h1>
    <span class="time-stamp"
      ><%= new Date(video.createdAt).toLocaleDateString() %></span
    >
    <div class="video-container">
      <video
        controls
        muted
        data-src="<%- video.url %>"
        class="lazy-video"
      ></video>
    </div>
    <div class="link-btn-container">
      <form
        action="/video/delete/<%= video._id %>?_method=DELETE"
        method="POST"
        onsubmit="return confirmDelete()"
      >
        <input type="submit" value="Delete" class="link-btn" />
      </form>

      <a href="/video/update/<%- video._id  %>" class="link-btn">Edit</a>
      <a href="<%-video.url  %>" class="link-btn" download target="_blank"
        >Download</a
      >
    </div>
  </div>
</section>
<script>
  function confirmDelete() {
    return confirm("Are you sure you want to delete this post?");
  }

  // Lazy load video
  const lazyVideos = document.querySelectorAll(".lazy-video");

  const loadVideo = (video) => {
    video.src = video.dataset.src;
    video.load();
  };

  const videoObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        loadVideo(entry.target);
        observer.unobserve(entry.target);
      }
    });
  });

  lazyVideos.forEach((video) => {
    videoObserver.observe(video);
  });
</script>
